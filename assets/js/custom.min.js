"use strict";function showLoading(){loadingIndicator.style.display="block"}function hideLoading(){loadingIndicator.style.display="none"}function sanitizeHTML(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function getReviews(){showLoading(),fetch("https://rsudgenteng.banyuwangikab.go.id/home/ambil_review?inovasi="+encodeURIComponent(inovasinya)).then(t=>t.json()).then(t=>{t.forEach(t=>{ratingsCount[t.bintang]++,totalRatings++}),t.slice(0,3).forEach(t=>{const e=document.createElement("div");e.classList.add("review"),e.innerHTML=`\n                    <p><strong>Rating: ${sanitizeHTML(t.bintang.toString())}/5</strong></p>\n                    <p>${sanitizeHTML(t.tulisan)}</p>\n                    <p>Inovasi: ${sanitizeHTML(t.inovasi)}</p>\n                    <p>Tanggal: ${sanitizeHTML(t.tanggal)}</p>`,reviewsContainer.appendChild(e)}),updateBars()}).catch(t=>{console.error("Error:",t),hideLoading()})}function getStarColorClass(t){switch(t){case 1:return"one";case 2:return"two";case 3:return"three";case 4:return"four";case 5:return"five";default:return""}}function updateBars(){hideLoading();const t=((5*ratingsCount[5]+4*ratingsCount[4]+3*ratingsCount[3]+2*ratingsCount[2]+1*ratingsCount[1])/totalRatings).toFixed(1);document.getElementById("average-rating").innerText=`${t} rata-rata dari ${totalRatings} review.`;for(let t=1;t<=5;t++){document.getElementById(`count-${t}`).innerText=ratingsCount[t];const e=document.querySelector(`.bar-${t}`);e.style.width=`${ratingsCount[t]/totalRatings*100}%`}}const stars=document.querySelectorAll(".star"),rating=document.getElementById("rating"),tulisanText=document.getElementById("tulisan"),submitBtn=document.getElementById("submit"),reviewsContainer=document.getElementById("reviews"),loadingIndicator=document.getElementById("loading-indicator"),allowedChars=/^[a-zA-Z0-9 .,?!-]*$/;let totalRatings=0,ratingsCount={1:0,2:0,3:0,4:0,5:0};stars.forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-value"));rating.textContent=e,stars.forEach(t=>t.classList.remove("one","two","three","four","five")),stars.forEach((t,n)=>{n<e&&t.classList.add(getStarColorClass(e))}),stars.forEach(t=>t.classList.remove("selected")),t.classList.add("selected")})}),submitBtn.addEventListener("click",()=>{const t=tulisanText.value,e=parseInt(rating.textContent),n=(new Date).toISOString().split("T")[0];if(!e||!t||!inovasinya)return void alert("Please select a rating and provide a review and innovation before submitting.");if(!allowedChars.test(t))return void alert("Review contains invalid characters. Please remove any special characters.");const a={tulisan:t,bintang:e,inovasi:inovasinya,tanggal:n},i=new FormData;for(const t in a)a.hasOwnProperty(t)&&i.append(t,a[t]);showLoading(),fetch("https://rsudgenteng.banyuwangikab.go.id/home/tambah_review",{method:"POST",body:i}).then(t=>t.json()).then(a=>{console.log("Success:",a);const i=document.createElement("div");i.classList.add("review"),i.innerHTML=`\n                <p><strong>Rating: ${sanitizeHTML(e.toString())}/5</strong></p>\n                <p>${sanitizeHTML(t)}</p>\n                <p>Inovasi: ${sanitizeHTML(inovasinya)}</p>\n                <p>Tanggal: ${sanitizeHTML(n)}</p>`,reviewsContainer.appendChild(i),ratingsCount[e]++,totalRatings++,updateBars(),tulisanText.value="",rating.textContent="0",stars.forEach(t=>t.classList.remove("one","two","three","four","five","selected"))}).catch(t=>{console.error("Error:",t),hideLoading()})}),getReviews();
